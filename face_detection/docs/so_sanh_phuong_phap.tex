\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[vietnamese]{babel}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{geometry}
\usepackage{tikz}
\usepackage{float}

\geometry{margin=2.5cm}

\definecolor{success}{RGB}{39, 174, 96}
\definecolor{warning}{RGB}{241, 196, 15}
\definecolor{danger}{RGB}{231, 76, 60}

\title{\textbf{So sánh các Phương pháp Phát hiện Khuôn mặt}}
\author{Face Detection Project}
\date{\today}

\begin{document}

\maketitle

\section{Tổng quan}

Tài liệu này so sánh 3 phương pháp phát hiện khuôn mặt:

\begin{table}[H]
\centering
\begin{tabular}{|l|p{10cm}|}
\hline
\textbf{Phương pháp} & \textbf{Mô tả} \\
\hline
HOG + SVM (Sliding) & Đặc trưng HOG + SVM với sliding window cơ bản \\
\hline
HOG + SVM (Optimized) & Đặc trưng HOG + SVM với NMS tối ưu \\
\hline
Raw Pixel + SVM & Pixel thô (không trích xuất đặc trưng) + SVM \\
\hline
\end{tabular}
\caption{Tổng quan các phương pháp}
\end{table}

\section{Kết quả thực nghiệm}

\subsection{Kết quả thực tế (Ảnh nhóm người)}

\begin{table}[H]
\centering
\begin{tabular}{|l|c|c|l|}
\hline
\textbf{Phương pháp} & \textbf{Số mặt phát hiện} & \textbf{Đúng/Sai} & \textbf{Đánh giá} \\
\hline
HOG+SVM (Sliding) & 64+ boxes & Nhiều sai & \cellcolor{warning!30}Quá nhiều false positive \\
\hline
HOG+SVM (Optimized) & 10 boxes & Đúng & \cellcolor{success!30}Chính xác \\
\hline
Raw Pixel + SVM & \textbf{0 boxes} & -- & \cellcolor{danger!30}Hoàn toàn thất bại \\
\hline
\end{tabular}
\caption{Kết quả thực tế trên ảnh nhóm 10 người}
\end{table}

\section{Phân tích chi tiết}

\subsection{Tại sao Raw Pixel + SVM thất bại?}

\subsubsection{Vấn đề cốt lõi}

Raw Pixel học pattern cố định theo vị trí:

\begin{equation}
f_{raw}(x, y) = I(x, y) \quad \text{(giá trị pixel tại vị trí cố định)}
\end{equation}

Khi training, mặt luôn ở giữa ảnh $\Rightarrow$ model học:
\begin{itemize}
    \item Pixel $(32, 32)$ có giá trị $\approx 150$ $\Rightarrow$ là mặt
    \item Pixel $(10, 10)$ có giá trị $\approx 50$ $\Rightarrow$ là tóc/background
\end{itemize}

Khi sliding window trên ảnh thật:
\begin{itemize}
    \item Mặt có thể ở \textbf{bất kỳ vị trí nào} trong window
    \item Pattern vị trí không còn đúng $\Rightarrow$ \textbf{Không detect được}
\end{itemize}

\subsubsection{Minh họa}

\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=0.8]
    % Training case
    \draw[thick] (0,0) rectangle (4,4);
    \draw[fill=gray!30] (1.2,1.2) rectangle (2.8,2.8);
    \node at (2,2) {Mặt};
    \node at (2,-0.5) {Training: Mặt ở giữa};
    \node at (2,-1) {\textcolor{success}{Raw Pixel: $\checkmark$}};
    
    % Testing case
    \draw[thick] (6,0) rectangle (10,4);
    \draw[fill=gray!30] (7.5,2.5) rectangle (9.3,3.8);
    \node at (8.4,3.15) {Mặt};
    \node at (8,-0.5) {Test: Mặt lệch góc};
    \node at (8,-1) {\textcolor{danger}{Raw Pixel: $\times$}};
\end{tikzpicture}
\caption{Raw Pixel không có tính bất biến vị trí}
\end{figure}

\subsection{Tại sao HOG hoạt động?}

\subsubsection{Công thức HOG}

Gradient tại mỗi pixel:
\begin{align}
G_x &= I(x+1, y) - I(x-1, y) \\
G_y &= I(x, y+1) - I(x, y-1)
\end{align}

Magnitude và orientation:
\begin{align}
|G| &= \sqrt{G_x^2 + G_y^2} \\
\theta &= \arctan\left(\frac{G_y}{G_x}\right)
\end{align}

HOG tính histogram của $\theta$ trong mỗi cell, sau đó chuẩn hóa theo block.

\subsubsection{Tính bất biến}

\begin{table}[H]
\centering
\begin{tabular}{|l|c|c|}
\hline
\textbf{Biến đổi} & \textbf{Raw Pixel} & \textbf{HOG} \\
\hline
Thay đổi độ sáng & \textcolor{danger}{Thay đổi hoàn toàn} & \textcolor{success}{Không đổi} \\
\hline
Thay đổi contrast & \textcolor{danger}{Thay đổi} & \textcolor{success}{Ít ảnh hưởng} \\
\hline
Dịch chuyển nhỏ & \textcolor{danger}{Thay đổi hoàn toàn} & \textcolor{warning}{Ảnh hưởng ít} \\
\hline
\end{tabular}
\caption{So sánh tính bất biến}
\end{table}

\textbf{Giải thích:} Khi thay đổi độ sáng $I' = I + c$:
\begin{itemize}
    \item Raw Pixel: $f'_{raw} = I + c \neq f_{raw}$ (thay đổi)
    \item HOG: $G'_x = (I+c)(x+1) - (I+c)(x-1) = G_x$ (không đổi)
\end{itemize}

\subsection{Vấn đề của HOG Sliding Window}

HOG + SVM detect đúng, nhưng sliding window tạo ra nhiều boxes chồng chéo:

\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=0.6]
    % Multiple overlapping boxes
    \draw[thick, yellow] (0,0) rectangle (3,3);
    \draw[thick, yellow] (0.3,0.2) rectangle (3.3,3.2);
    \draw[thick, yellow] (0.5,0.4) rectangle (3.5,3.4);
    \draw[thick, yellow] (-0.2,0.1) rectangle (2.8,3.1);
    \draw[fill=gray!50] (1,1) rectangle (2.5,2.5);
    \node at (1.75,1.75) {Mặt};
    \node at (1.75,-0.8) {Sliding: Nhiều boxes};
    
    % After NMS
    \draw[thick, green] (6,0.5) rectangle (9,3.5);
    \draw[fill=gray!50] (7,1) rectangle (8.5,2.5);
    \node at (7.75,1.75) {Mặt};
    \node at (7.75,-0.8) {Sau NMS: 1 box};
\end{tikzpicture}
\caption{Non-Maximum Suppression (NMS) loại bỏ boxes trùng}
\end{figure}

\section{Kết luận}

\subsection{Ranking}

\begin{table}[H]
\centering
\begin{tabular}{|c|l|l|}
\hline
\textbf{Rank} & \textbf{Phương pháp} & \textbf{Nhận xét} \\
\hline
\cellcolor{success!30}1 & HOG + SVM (Optimized) & Production-ready, chính xác \\
\hline
\cellcolor{warning!30}2 & HOG + SVM (Sliding) & Cần thêm NMS \\
\hline
\cellcolor{danger!30}3 & Raw Pixel + SVM & Không hoạt động thực tế \\
\hline
\end{tabular}
\caption{Xếp hạng các phương pháp}
\end{table}

\subsection{Bài học}

\begin{enumerate}
    \item \textbf{Feature engineering quyết định hiệu quả}
    \begin{itemize}
        \item Raw Pixel không trích xuất đặc trưng $\Rightarrow$ không detect được gì
        \item HOG trích xuất gradient/edge $\Rightarrow$ detect chính xác khuôn mặt
    \end{itemize}
    
    \item \textbf{Tính bất biến rất quan trọng}
    \begin{itemize}
        \item Raw Pixel nhạy cảm với vị trí, ánh sáng $\Rightarrow$ thất bại hoàn toàn
        \item HOG bất biến với ánh sáng, robust với vị trí $\Rightarrow$ hoạt động tốt
    \end{itemize}
    
    \item \textbf{Post-processing cần thiết}
    \begin{itemize}
        \item Sliding window tạo nhiều boxes chồng chéo
        \item NMS giúp gộp và loại bỏ duplicate boxes
    \end{itemize}
\end{enumerate}

\end{document}
